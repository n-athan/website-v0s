function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var c,r,a,q,score,morelines,fourlines,threelines,oneline,amp,gameOver,pauze;function getSize(){var e;if(window.innerWidth<450)e=400;else if(window.innerWidth<900){var t=.7*window.innerWidth;e=t>window.innerHeight?window.innerHeight-250:Math.floor(t)}else{var r=document.getElementById("controls").offsetWidth;e=r>window.innerHeight?window.innerHeight-50:Math.floor(r)}return e}function preload(){hit=loadSound("tetrisSounds\\hit.mp3")}function setup(){var e=getSize();cols=floor(select("#cols").value()),(cols<3||cols>40)&&(alert("Number of colums must be between 3 and 40. Number set to 15."),cols=15,select("#cols").value(15)),rows=floor(select("#rows").value()),(rows<3||rows>40)&&(alert("Number of rows must be between 3 and 40. Number set to 15."),rows=15,select("#rows").value(15)),scl=min(min(25,e/cols),min(25,e/rows)),scl=floor(scl),w=cols*scl,h=rows*scl,createCanvas(w,h),colorMode(HSL,360,100,100,1),rectMode(CORNER),grid=[],s=20,c=floor(width/scl),r=floor(height/scl),q=new Quatra,score=0,gameOver=!1,pauze=!1;for(var t=0,o=0;o<r;o++)for(var i=0;i<c;i++)grid[t]=[0,0,0,0],t++;for(var n in highscore=window.localStorage.getItem("vier"),highscore=JSON.parse(highscore),null==highscore&&(highscore={}),select("#scoreP").html("Score: "+score),highscoreT="<table><tr class='en'><td>ColumnsxRows</td><td>Highscore</td></tr><tr class='nl'><td>KolommenxRijen</td><td>Highscore</td></tr>",highscore)highscoreT+="<tr><td>"+n+"</td><td>"+highscore[n]+"</td></tr>";highscoreT+="</table>",select("#highScoreP").html(highscoreT),noScroll(),document.getElementById("defaultCanvas0").focus(),hit.setVolume(.1),morelines=loadSound("tetrisSounds\\moreLines.mp3"),fourlines=loadSound("tetrisSounds\\4lines.mp3"),threelines=loadSound("tetrisSounds\\3lines.mp3"),oneline=loadSound("tetrisSounds\\1line.mp3")}function draw(){background(30,10,60,1),select("#scoreP").html("Score: "+score),noStroke();for(var e=0,t=0;t<r;t++)for(var o=0;o<c;o++)fill(grid[e][0],grid[e][1],grid[e][2],grid[e][3]),e++,rect(o*scl,t*scl,scl,scl);gameOver?end&&(a+=.01,end.background(color(267,100,38,a)),end.text(text,width/2,height/2),image(end,0,0)):(isGameOver(),q.show(),q.update())}function keyPressed(){keyCode===UP_ARROW?q.rotLeft():keyCode===DOWN_ARROW?q.rotRight():keyCode===LEFT_ARROW?q.move(-1):keyCode===RIGHT_ARROW?q.move(1):32===keyCode?q.moveDown():27===keyCode&&(pauze?loop():noLoop(),pauze=!pauze)}function removeLine(){for(var e=0,t=[],o=r-1;o>=0;o--)for(var i=0,s=0;s<c;s++)0==alpha(grid[o*c+s])?s+=c:alpha(grid[o*c+s])>0&&(i+=1)==c&&(score+=c,e+=1,t.push(o),checkSpeed());for(var n=t.length;n>=0;n--)for(var a=t[n];a>0;a--)for(var h=0;h<c;h++)grid[a*c+h]=grid[(a-1)*c+h];playSound(e)}function checkSpeed(){score>0&&score%(5*c)==0&&(s-=1,constrain(s,0,100))}function playSound(e){e>=4?morelines.play():3==e?fourlines.play():2==e?threelines.play():1==e&&oneline.play()}function isGameOver(){for(var e=0;e<=c;e++)alpha(grid[e])>0&&(gameOver=!0,endGame())}function refresh(){select("#scoreP").html("Score: 0"),setup()}function endGame(){var e=cols.toString()+"x"+rows.toString(),t=highscore[e];t?score>t&&(highscore[e]=score):highscore[e]=score,endScreen(t),window.localStorage.setItem("vier",JSON.stringify(highscore)),setTimeout(function(){end=void 0,refresh()},3e3)}function endScreen(e){a=0,end=createGraphics(width,height),end.colorMode(HSL,360,100,100,1),end.background(color(267,100,38,0)),end.textAlign(CENTER),end.fill(249,30,10,1),text="Score: "+score,(score>e||!e)&&(text+="\n New Highscore!"),end.textFont("Space Mono"),end.textSize(scl),end.textStyle(BOLD),end.text(text,width/2,height/2),movesLeft="-"}function noScroll(){document.getElementsByTagName("body")[0].addEventListener("keydown",function(e){var t=e.which;35!=t&&36!=t&&37!=t&&39!=t&&32!=t||e.preventDefault()},!1)}shapes=[[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,0,0,0],[1,1,0,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,1],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[1,0,0,0],[1,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,0,1,0],[1,1,1,0],[0,0,0,0]]],colors=[50,220,10,"g","w","g","w"];var Quatra=function(){function e(){_classCallCheck(this,e),this.i=-2,this.j=floor(c/2-2),this.r=floor(random(0,7)),this.shape=shapes[this.r],"g"==colors[this.r]?this.clr=color(10,10,10,1):"w"==colors[this.r]?this.clr=color(0,0,100,1):this.clr=color(colors[this.r],90,50,1),this.speed=s,this.speedcounter=0}return _createClass(e,[{key:"show",value:function(){fill(this.clr),noStroke();for(var e=0;e<4;e++)for(var t=0;t<4;t++)1==this.shape[e][t]&&rect((this.j+t)*scl,(this.i+e)*scl,scl,scl)}},{key:"update",value:function(){this.speedcounter==this.speed&&(this.i+=1,this.stopMoving("vert",1),this.speedcounter=0),this.speedcounter++}},{key:"stopMoving",value:function(t,r){if(this.hasHit()){hit.play(),"vert"==t&&(this.i-=r);for(var o=0;o<4;o++)for(var i=0;i<4;i++){var s=this.i+o,n=this.j+i,a=s*c+n;1==this.shape[o][i]&&(grid[a]=[hue(this.clr),saturation(this.clr),lightness(this.clr),alpha(this.clr)])}return noLoop(),removeLine(),loop(),q=new e,!0}}},{key:"rotLeft",value:function(){for(var e=[[],[],[],[]],t=0;t<4;t++)for(var r=0;r<4;r++)e[r][t]=this.shape[t][3-r];this.shape=e;var o=this.getMax();this.j+o[0]>=c-1?this.j-=1:this.j+o[2]<=0&&(this.j+=1)}},{key:"rotRight",value:function(){for(var e=[[],[],[],[]],t=0;t<4;t++)for(var r=0;r<4;r++)e[r][t]=this.shape[3-t][r];this.shape=e;var o=this.getMax();this.j+o[0]>=c-1?this.j-=1:this.j+o[2]<=0&&(this.j+=1)}},{key:"move",value:function(e){var t=this.getMax();if(1==e){if(this.j+t[0]>=c-1)return;this.j+=e,this.hasHit()&&(this.j-=e)}else if(-1==e){if(this.j+t[2]<=0)return;this.j+=e,this.hasHit()&&(this.j-=e)}}},{key:"moveDown",value:function(){var e=this.getDistBottom();this.i=this.i+e}},{key:"getMax",value:function(){for(var e=4,t=-1,r=4,o=0;o<4;o++)for(var i=0;i<4;i++)1==this.shape[o][i]&&(e=min(e,i),t=max(t,i),r=max(r,o));return[t,r,e]}},{key:"getDistBottom",value:function(){for(var e=this.getMax(),t=r-(this.i+e[1]),o=e[2]+this.j;o<=e[0]+this.j;o++)for(var i=e[1]+this.i;i<r;i++)alpha(grid[i*c+o])>0&&(t=min(t,i-(e[1]+this.i)));return t}},{key:"hasHit",value:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)if(1==this.shape[e][t]){var o=(this.i+e)*c+this.j+t;if(o<0);else{if(o>c*r-1)return!0;if(alpha(grid[o])>0)return!0}}return!1}}]),e}();